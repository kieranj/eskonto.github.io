<!DOCTYPE html>
<html>
<head>
  <title>BitEscrow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>  
  <link href='http://fonts.googleapis.com/css?family=Condiment' rel='stylesheet' type='text/css'>
  <link href='src/css/adminflare.min.css' rel='stylesheet' type='text/css'>
  <link href='src/css/style.css' rel='stylesheet' type='text/css'>
</head>
<body>
  <header class="navbar navbar-fixed-top" id="main-navbar">
    <div class="navbar-inner">
      <div class="container">
        <a href="/" class="brand">BitEscrow</a>
        <ul class="nav pull-right">
          <li id="login">
            <a href="#login">Login</a>
          </li>
          <li id="signup">
            <a href="#signup">Sign Up</a>
          </li>
          <li id="logout" style="display: none;">
            <a href="#logout">Logout</a>
          </li>
        </ul>
      </div>
    </div>
  </header>
  
  <nav id="left-panel">
  	<div id="left-panel-content">
			<ul>
				<li>
					<a href="dashboard.html"><span class="icon-dashboard"></span>Dashboard</a>
				</li>
				<li class="active">
					<a href="layout.html"><span class="icon-th-large"></span>Layout</a>
				</li>
				<li>
					<a href="typography.html"><span class="icon-font"></span>Typography</a>
				</li>
				<li>
					<a href="forms.html"><span class="icon-edit"></span>Forms</a>
				</li>
				<li>
					<a href="tables.html"><span class="icon-table"></span>Tables</a>
				</li>
				
				<li>
					<a href="components.html"><span class="icon-inbox"></span>Components</a>
				</li>
				<li>
					<a href="javascript.html"><span class="icon-cog"></span>JavaScript</a>
				</li>
				<li class="lp-dropdown">
					<a href="#" class="lp-dropdown-toggle" id="extras-dropdown"><span class="icon-reorder"></span>Extras</a>
					<ul class="lp-dropdown-menu" data-dropdown-owner="extras-dropdown">
						<li>
							<a tabindex="-1" href="extras-icons.html"><span class="icon-coffee"></span>Icons</a>
						</li>
						<li>
							<a tabindex="-1" href="extras-charts.html"><span class="icon-bar-chart"></span>Charts</a>
						</li>
						<li>
							<a tabindex="-1" href="extras-widgets.html"><span class="icon-star"></span>Widgets</a>
						</li>
					</ul>
				</li>
				<li class="lp-dropdown">
					<a href="#" class="lp-dropdown-toggle" id="pages-dropdown"><span class="icon-file-alt"></span>Pages</a>
					<ul class="lp-dropdown-menu simple" data-dropdown-owner="pages-dropdown">
						<li>
							<a tabindex="-1" href="index.html"><i class="icon-signin"></i>&nbsp;&nbsp;Sign In</a>
						</li>
						<li>
							<a tabindex="-1" href="pages-signup.html"><i class="icon-check"></i>&nbsp;&nbsp;Sign Up</a>
						</li>
						<li>
							<a tabindex="-1" href="pages-messages.html"><i class="icon-envelope-alt"></i>&nbsp;&nbsp;Messages</a>
						</li>
						<li>
							<a tabindex="-1" href="pages-stream.html"><i class="icon-leaf"></i>&nbsp;&nbsp;Stream</a>
						</li>
						<li>
							<a tabindex="-1" href="pages-pricing.html"><i class="icon-money"></i>&nbsp;&nbsp;Pricing</a>
						</li>
						<li>
							<a tabindex="-1" href="pages-invoice.html"><i class="icon-pencil"></i>&nbsp;&nbsp;Invoice</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>
		<div class="icon-caret-down"></div>
		<div class="icon-caret-up"></div>
	</nav>
  
  <div class="container" id="content">
    <p>Please <a href="/signup">signup</a> to create an escrow agreement</p>
  </div>

  <script type="text/x-handlebars-template" id="login_tmpl">
    <form class="form-horizontal">
      <fieldset>
      <div class="control-group">
        <label for="user_email" class="control-label">Email</label>
        <div class="controls">
          <input type="text" id="user_email" name="user[email]" />
        </div>
      </div>

      <div class="control-group">
        <label for="user_password" class="control-label">Password</label>
        <div class="controls">
          <input type="password" id="user_password" name="user[password]" />
        </div>
      </div>  

      <div class="form-actions">
        <input name="commit" class="btn btn-primary" type="submit" value="Sign in" />
        <img src="img/spinner.gif" id="spinner" />
      </div>
    </form>
  </script>

  <script type="text/x-handlebars-template" id="sign_up_tmpl">
    <form class="form-horizontal">
      <fieldset>
      <div class="control-group">
        <label for="user_email" class="control-label">Email</label>
        <div class="controls">
          <input type="text" id="user_email" name="user[email]" />
        </div>
      </div>

      <div class="control-group">
        <label for="user_password" class="control-label">Password</label>
        <div class="controls">
          <input type="password" id="user_password" name="user[password]" />
        </div>
      </div>

      <div class="control-group">
        <label for="user_password_confirmation" class="control-label">Password Confirmation</label>
        <div class="controls">
          <input type="password" id="user_password_confirmation" name="user[password_confirmation]" />
        </div>
      </div>  

      <div class="form-actions">
        <input name="commit" class="btn btn-primary" type="submit" value="Sign up" />
        <img src="img/spinner.gif" id="spinner" />
      </div>
    </form>
  </script>

  <script type="text/x-handlebars-template" id="escrows_tmpl">
    <a class="btn btn-primary" href="/escrows/new">New Escrow</a>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Created</th>
          <th>Description</th>
          <th>Amount</th>
          <th>Address</th>
          <th>With</th>
          <th>Status</th>
      </thead>
      <tbody>
        {{#each escrows}}
          <tr>
            <td>
              {{dateFormat created_at format="DD/MM/YY hh:mm"}}
            </td>
            <td>
              <a href="/escrows/{{uuid}}">{{description}}</a>
            </td>
            <td>
              {{amount}} BTC
            </td>
            <td>
              {{address}}
            </td>
            <td>
              {{#if is_payer}}
                {{payee.email}}
              {{else}}
                {{payer.email}}
              {{/if}}
            </td>
            <td>
              {{status}}
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </script>

  <script type="text/x-handlebars-template" id="create_escrow_tmpl">
    <form id="create" class="form-horizontal">
      <fieldset>
        <legend>Create a new Escrow</legend>

        <div class="control-group">
          <div class="controls">
            <p>I would like to:</p>
            <label for="payer">
              <input type="radio" id="payer" class="radio inline" name="escrow[role]" value="payer" /> Send
            </label>

            <label for="payee">
              <input type="radio" id="payee" class="radio inline" name="escrow[role]" value="payee" /> Receive
            </label>
          </div>
        </div>

        <div class="control-group">
          <label for="description" class="control-label">Description</label>
          <div class="controls">
            <input type="text" id="description" name="escrow[description]" />
          </div>
        </div>

        <div class="control-group">
          <label for="amount" class="control-label">Amount</label>
          <div class="controls">
            <input type="text" id="amount" name="escrow[amount]" />
          </div>
        </div>
      </fieldset>

      <div class="form-actions">
        <input type="submit" class="btn btn-primary" value="Create" />
        <img src="img/spinner.gif" id="spinner" />
      </div>
    </form>

    <div id="escrow-modal" class="modal hide fade" data-backdrop="static">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Confirm Email Sent</h3>
      </div>
      <div class="modal-body">
        <h5>Please send the following text to the person you wish join you in this escrow agreement</h5>

        <div class="alert alert-warning">
          <strong>Make a note of the payment verification code as you will need this to collect the funds</strong>
        </div>

        <textarea class="input-xxlarge" rows="14" id="escrow-email"></textarea>
      </div>
      <div class="modal-footer">
        <a href="/escrows" class="btn btn-primary">Confirm</a>
      </div>
    </div>
  </script>

  <script type="text/x-handlebars-template" id="escrow_tmpl">
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span9">
          <p><a href="/escrows" class="btn">Back to My Escrows</a></p>

          <h2>{{description}}</h2>

          {{#if address}}
            <h4>Escrow Address: {{address}}</h4>
          {{/if}}
          
          {{#if accepted}}
            {{#if is_payer}}
              <h4>Escrow with: {{payee.email}}</h4>
            {{else}}
              <h4>Escrow with: {{payer.email}}</h4>
            {{/if}}
          {{/if}}

          {{#if verify}}
            {{#unless is_originator}}
              <p>Please verify the escrow with the code you were emailed.</p>
              <p><a href="/escrows/{{uuid}}/verify" class="btn btn-primary">Verify</a></p>
            {{/unless}}
          {{/if}}

          {{#if accepted}}
            {{#if is_payer}}
              <div class="alert alert-error">
                <strong>Please verify the balance matches the funds you expect</strong>
              </div>
              <a href="/escrows/{{uuid}}/release" id="release" class="btn btn-primary">Release Funds</a>
            {{/if}}

            {{#if is_payee}}
              <div class="alert">
                <strong>Waiting for payment from: {{payer.email}}</strong>
              </div>
            {{/if}}
          {{/if}}
          
          {{#if released}}
            {{#if is_payer}}
              <p>The funds have now been made available to {{payee.email}}</p>
            {{/if}}

            {{#if is_payee}}
              <a href="/escrows/{{uuid}}/redeem" class="btn btn-primary">Redeem Funds</a>
            {{/if}}
          {{/if}}
        </div>

        {{#if address}}
          <div class="span3">
            <div class="well">
              <h4>Balance</h4>
              <h4>{{balance}} BTC</h4>
            </div>
          </div>
        {{/if}}
      </div>
    </div>
  </script>

  <script type="text/x-handlebars-template" id="verify_escrow_tmpl">
    <h4>Enter your Payment Invitation to verify the Escrow</h4>

    <form id="verify" class="form-horizontal" data-role="{{#if is_payee}}payee{{else}}payer{{/if}}">
      <fieldset>
        <div class="control-group">
          <label class="control-label">Payment Invitation</label>
          <div class="controls">
            <input type="text" id="verify-code2" class="input-xlarge" />
          </div>
        </div>
      </fieldset>

      <div class="form-actions">
        <input type="submit" class="btn btn-primary" value="Verify">
      </div>
    </form>

    <div id="verify-modal" class="modal hide fade" data-backdrop="static">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Verification Result</h3>
      </div>
      <div class="modal-body">
        <p id="verification"> ... not yet verified ... </p>
      </div>
      <div class="modal-footer">
        <a href="javascript:void(0)" class="btn btn-primary">Close</a>
      </div>
    </div>
  </script>

  <script type="text/x-handlebars-template" id="redeem_escrow_tmpl">
    <form id="redeem" class="form-horizontal">
      <fieldset>
        <legend>Please enter your payment invitation to extract the private key</legend>

        <div class="control-group">
          <label class="control-label">Invite Code</label>
          <div class="controls">
            <input type="text" id="einvp" name="escrow[einvp]" class="input-xxlarge" />
          </div>
        </div>
      </fieldset>

      <fieldset>
        <div class="control-group">
          <label class="control-label">Address</label>
          <div class="controls">
            <input type="text" id="redeem-address" name="escrow[redeem-address]" class="input-xxlarge" />
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">Private Key</label>

          <div class="controls">
            <input type="text" id="redeem-wif" name="escrow[redeem-wif]" class="input-xxlarge" />
          </div>
        </div>
      </fieldset>

      <div class="form-actions">
        <input type="submit" class="btn btn-primary" value="Redeem" />
        <a href="/escrows" class="btn">Back</a>
      </div>
    </form>
  </script>

  <script type="text/javascript" src="lib/js/jquery-2.0.0.min.js"></script>
  <script type="text/javascript" src="lib/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="lib/js/underscore-min.js"></script>
  <script type="text/javascript" src="lib/js/backbone-min.js"></script>
  <script type="text/javascript" src="lib/js/backbone_filters.js"></script>
  <script type="text/javascript" src="lib/js/moment.min.js"></script>
  <script type="text/javascript" src="lib/js/jquery.cookie.js"></script>
  <script type="text/javascript" src="lib/js/handlebars.js"></script>
  <script type="text/javascript" src="lib/js/elliptic.curve.js"></script>
  <script type="text/javascript" src="lib/js/crypto.js"></script>
  <script type="text/javascript" src="lib/js/secure.random.js"></script>
  <script type="text/javascript" src="lib/js/bigint.js"></script>
  <script type="text/javascript" src="lib/js/bitcoin.base58.js"></script>
  <script type="text/javascript" src="lib/js/bitcoin.address.js"></script>
  <script type="text/javascript" src="lib/js/bitcoin.ecdsa.js"></script>
  <script type="text/javascript" src="lib/js/bitcoin.escrow.js"></script>
  
  <script type="text/javascript" src="src/js/helpers.js"></script>           
  <script type="text/javascript" src="src/js/app.js"></script>            
  <script type="text/javascript" src="src/js/models/escrow.js"></script>            
  <script type="text/javascript" src="src/js/collections/escrows.js"></script>

  <script type="text/javascript" src="src/js/views/escrow_base_view.js"></script>
  <script type="text/javascript" src="src/js/views/create_escrow.js"></script>
  <script type="text/javascript" src="src/js/views/escrow_base_view.js"></script>
  <script type="text/javascript" src="src/js/views/escrows_list.js"></script>
  <script type="text/javascript" src="src/js/views/login.js"></script>
  <script type="text/javascript" src="src/js/views/redeem_escrow.js"></script>
  <script type="text/javascript" src="src/js/views/show_escrow.js"></script>
  <script type="text/javascript" src="src/js/views/sign_up.js"></script>
  <script type="text/javascript" src="src/js/views/verify_escrow.js"></script>                      
  <script type="text/javascript" src="src/js/routes.js"></script>

  <script>
    App.initialize();

    $(function($) {
      return $(document).delegate("a", "click", function(evt) {
        var href, protocol;
        if ($(this).hasClass("js")) {
          return;
        }
        href = $(this).attr("href");
        protocol = this.protocol + "//";
        if (href.slice(protocol.length) !== protocol) {
          evt.preventDefault();
          return App.Router.navigate(href, {
            trigger: true
          });
        }
      });
    });
  </script>
</body>
</html>
